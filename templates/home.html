{% extends '_base.html' %}

{% block content %}
  <h1 class="title">
    Recipe search
  </h1>
  <p class="subtitle">
    Enter your ingredients into the search bar, adjust the search settings to your liking and find today's dinner.
  </p>
  <div class="columns">
    <div class="column is-5">
      {% include 'recipes/search.html' %}
    </div>
    {% if recipes %}
      <div class="column is-5">
        <h3 class="title is-2">Recipes found:</h3>
        {% for recipe in recipes %}
          {% include 'recipes/recipe_listing.html' %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  <script>
      let ingredient_search = document.getElementById("ingredient-search");
      let all_ingredients = Array.from(document.getElementById("ingredients").children);
      let selected_ingredients = [];

      function append_ingredient_to_list() {
          let ingredient = ingredient_search.value;
          selected_ingredients.push(ingredient);
          all_ingredients.find(elem => elem.value === ingredient).remove();

          add_to_ingredient_list(ingredient);
          ingredient_search.value = "";
      }

      function add_to_ingredient_list(ingredient) {
          let ingredient_tag_elem = '<p class="field" id="' + ingredient + '-select-p">' +
              '<span class="tag is-primary is-medium"><span class=selected_ingredient_span>' + ingredient + '</span>' +
              '<button class="delete is-small" onclick="put_back_ingredient(event)"></button></span></p>';
          document.getElementById("selected-ingredients-container").insertAdjacentHTML('beforeend', ingredient_tag_elem);
      }

      function set_ingredients(e) {
          ingredient_search.value = selected_ingredients.join(",");
      }

      function put_back_ingredient(event) {
          let ingredient_name = event.target.previousSibling.innerText;
          let ingredient_p = document.getElementById(ingredient_name + "-select-p");
          ingredient_p.remove();
          selected_ingredients = selected_ingredients.filter(ingr => ingr !== ingredient_name);
          let ingredient_option = all_ingredients.find(ingr => ingr.value === ingredient_name);
          document.getElementById("ingredients").appendChild(ingredient_option);
      }
  </script>
{% endblock %}